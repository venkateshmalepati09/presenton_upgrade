# Prepare Presentation - Input Payload Example

## Overview
This shows the exact input payload for `POST /api/v1/ppt/presentation/prepare` after fetching conversation data.

## Complete Input Payload

```json
{
  "presentation_id": "e05105dd-cde3-48be-9abc-123456789012",
  "outlines": [
    {
      "content": "Introduction to Visa Dataset Analysis\n\nOverview of the comprehensive data analysis report covering visa application trends, approval rates, and demographic insights."
    },
    {
      "content": "Query: What is the average processing time for visa applications?\nResponse: The average processing time for visa applications is 45 days, with variations based on visa type and country of origin."
    },
    {
      "content": "Query: What are the top 5 countries with highest visa approval rates?\nResponse: The top 5 countries are: 1) Canada (92%), 2) Australia (89%), 3) UK (87%), 4) Germany (85%), 5) France (83%)."
    },
    {
      "content": "Query: How has visa application volume changed over the past year?\nResponse: Visa applications increased by 23% compared to last year, with significant growth in student and work visa categories."
    },
    {
      "content": "Query: What are the main reasons for visa rejections?\nResponse: Top rejection reasons: 1) Incomplete documentation (35%), 2) Financial insufficiency (28%), 3) Previous violations (18%), 4) Security concerns (12%), 5) Other (7%)."
    },
    {
      "content": "Query: What is the demographic breakdown of visa applicants?\nResponse: Age distribution: 18-25 (32%), 26-35 (41%), 36-50 (19%), 50+ (8%). Gender: Male (58%), Female (42%)."
    },
    {
      "content": "Conclusion and Recommendations\n\nKey insights from the visa dataset analysis and actionable recommendations for improving application processes and approval rates."
    }
  ],
  "layout": {
    "name": "modern",
    "ordered": false,
    "slides": [
      {
        "id": "title_slide",
        "name": "Title Slide",
        "description": "Main title and subtitle",
        "json_schema": {
          "type": "object",
          "properties": {
            "title": {"type": "string"},
            "subtitle": {"type": "string"}
          }
        }
      },
      {
        "id": "content_slide",
        "name": "Content Slide",
        "description": "Text content with bullet points",
        "json_schema": {
          "type": "object",
          "properties": {
            "heading": {"type": "string"},
            "content": {"type": "array"}
          }
        }
      },
      {
        "id": "two_column_slide",
        "name": "Two Column Slide",
        "description": "Split content layout",
        "json_schema": {
          "type": "object",
          "properties": {
            "heading": {"type": "string"},
            "left_content": {"type": "string"},
            "right_content": {"type": "string"}
          }
        }
      }
    ]
  },
  "title": "Visa Dataset Analysis Report"
}
```

## Breakdown

### 1. `presentation_id` (UUID)
The ID returned from `POST /create` endpoint.

### 2. `outlines` (Array of SlideOutlineModel)
Each outline represents one slide. The content comes from:
- **Fetched conversations** formatted as:
  ```
  Query: [user question]
  Response: [API response]
  ```
- **Generated by LLM** from the `/outlines/stream` endpoint

**Example with fetched data:**
```json
{
  "content": "Query: What is the average processing time?\nResponse: 45 days average, varies by type and country."
}
```

### 3. `layout` (PresentationLayoutModel)
Template configuration with slide layouts:
- `name`: Template name (e.g., "modern", "minimal", "corporate")
- `ordered`: Whether slides follow a fixed order
- `slides`: Array of available slide layouts with schemas

### 4. `title` (Optional String)
Presentation title, can be auto-generated or user-provided.

## How the Fetched Content Flows

```
1. POST /create with JSON payload
   ↓
   Backend fetches conversations:
   {
     "query": "What is the average wage?",
     "response": "Average wage in 1819: $..."
   }
   ↓
   Formatted as text:
   "Query: What is the average wage?\nResponse: Average wage in 1819: $..."
   ↓
   Saved to PresentationModel.content

2. GET /outlines/stream
   ↓
   LLM reads the formatted content
   ↓
   Generates outlines (one per slide)
   ↓
   Returns: [
     {"content": "Query: ...\nResponse: ..."},
     {"content": "Query: ...\nResponse: ..."}
   ]

3. POST /prepare ← YOU ARE HERE
   ↓
   Receives the outlines from step 2
   ↓
   Maps each outline to a slide layout
   ↓
   Saves structure to database
```

## Python Example

```python
import requests
import json

# Assume you have the presentation_id from /create
presentation_id = "e05105dd-cde3-48be-9abc-123456789012"

# Outlines generated from your fetched conversation data
outlines = [
    {"content": "Query: What is X?\nResponse: X is..."},
    {"content": "Query: How does Y work?\nResponse: Y works by..."},
    # ... more outlines
]

# Simple layout
layout = {
    "name": "modern",
    "ordered": False,
    "slides": [
        {
            "id": "title_slide",
            "name": "Title",
            "json_schema": {"type": "object", "properties": {}}
        },
        {
            "id": "content_slide",
            "name": "Content",
            "json_schema": {"type": "object", "properties": {}}
        }
    ]
}

payload = {
    "presentation_id": presentation_id,
    "outlines": outlines,
    "layout": layout,
    "title": "My Presentation"
}

response = requests.post(
    "http://127.0.0.1:8000/api/v1/ppt/presentation/prepare",
    json=payload
)

print(response.json())
```

## Key Points

✅ **`outlines`** contains the fetched conversation data (formatted as "Query: ...\nResponse: ...")  
✅ **Each outline** = one slide in the final presentation  
✅ **`layout`** determines how each slide will look  
✅ **After `/prepare`**, call `/stream` to generate the actual slide content
